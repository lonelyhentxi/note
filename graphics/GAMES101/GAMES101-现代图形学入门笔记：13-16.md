# GAMES101-现代图形学入门笔记13-16：光线追踪

该课程是 GAMES 开设的现代计算机图形学课程，系统而全面的介绍：光栅化、几何表示、光的传播理论、动画与模拟。每个方面都从基础原理出发讲解到实际应用，并介绍前沿的理论研究。本文是其 13-16 章光线追踪的学习笔记。

## 1. 光线追踪概述

### 阴影 - Shadow Mapping

光栅化遇到的问题 —— 人们发明了在光栅化中绘制阴影的方法，称之为 Shadow mapping

#### 概述

本质上是一种图像空间的算法：
  - 在其阴影计算中不包含任何几何场景的信息
  - 必须处理采样偏倚

关键思想：如果点不在阴影中，却能够看到该点；说明摄像机可以 “看到” 这个点，同时光源也能够 “看到” 这个点

#### 步骤

- (1) 从光源看向场景：假设光源处有摄像机，进行光栅化，得到一幅深度阴影图像，无需进行着色
- (2A) 从摄像机看向场景：得到一副包含深度和色彩等的标准图像
- (2B) 投影到光源视角的场景：找到可视点对应光源视角场景的哪个像素上，如果深度一致则在阴影外，否则在阴影中

#### 问题

- 数值精度：在场景的各种距离涉及很多的浮点数，因此涉及精度问题 —— 考虑大小而非相等或者引入 bias，但不能完全解决问题
- 阴影走样：如果渲染的分辨率高，阴影的分辨率低，会引起阴影的走样
- 点光源和硬阴影：经典的 Shadow Mapping 只能处理点光源；“硬” 阴影：一个点要么在阴影里，要么不在阴影里的非 0 即 1 的过程

#### 光栅化阴影的改进

- 光栅化实现的软阴影：在物理上软阴影实际上是物理上的伴影，penumbra（反之为本影，umbra） —— 使用有大小的光源

### 光线追踪与光栅化

为什么要引入光线追踪？—— 光栅化无法很好地解决全局效果

- 软阴影
- 光泽反射，Glossy Reflection，在金属等表面反光但又不完全光滑的状态
- 间接光照，Indirect Illumination，光线在物体表面弹射不只一次

光栅化与光线追踪

- 光栅化是一种快速近似，但是质量相对较低，常被用来做实时应用
- 光线追踪是一种准确的方法，但是非常慢，常被用来做离线运算

### 基础的光线追踪的方法

关于光线的三个基本观点（因为简化并不在物理上完全正确）：

- 光线是直线传播的
- 光线在相交时并不碰撞
- 光线从光源传播到摄像机

实际上，光线追踪运用了光线的可逆性；假设从摄像机传播出，反射到光源来进行计算

#### 光线投射

步骤：

1. 通过每像素投射一条光线的方法生成一副图像 —— eye ray
2. 通过发射光线到光源的方法检查阴影 —— 

假设：

- 在一般的光线追踪中，总是认为眼睛是针孔摄像机
- 认为光线从眼睛射出到物体后，会按照镜面反射的方向射出